!function(t){var a={};function n(e){if(a[e])return a[e].exports;var s=a[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=a,n.d=function(t,a,e){n.o(t,a)||Object.defineProperty(t,a,{enumerable:!0,get:e})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,a){if(1&a&&(t=n(t)),8&a)return t;if(4&a&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(n.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&a&&"string"!=typeof t)for(var s in t)n.d(e,s,function(a){return t[a]}.bind(null,s));return e},n.n=function(t){var a=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(a,"a",a),a},n.o=function(t,a){return Object.prototype.hasOwnProperty.call(t,a)},n.p="",n(n.s=0)}([function(t,a,n){n(1),t.exports=n(2)},function(t,a,n){"use strict";function e(t,a){for(var n=0;n<a.length;n++){var e=a[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}n.r(a);var s=function(){function t(a){var n=this;!function(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}(this,t),this.root=a,this.wallet=this.create_wallet(),this.transactions=this.wallet.getElementsByClassName("transactions")[0].getElementsByTagName("div")[0],this.transfers={},this.states={transactions_opened:"state--open-transactions",loading:"state--loading"},this.reload(void 0,!0),this.wallet.getElementsByClassName("action--transactions")[0].addEventListener("click",function(t){return n.collapse_transactions(t)}),this.wallet.getElementsByClassName("action--refresh")[0].addEventListener("click",function(t){return n.reload(t)}),this.transactions.addEventListener("click",function(t){return n.transaction_details(t)}),this.transactions.addEventListener("scroll",function(){return n.preload_transactions_on_scroll()}),this.wallet.getElementsByClassName("info-id")[0].getElementsByTagName("span")[0].addEventListener("click",function(t){return n.copy_wallet()})}var a,n,s;return a=t,(n=[{key:"reload",value:function(t){var a=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0!==t&&t.preventDefault(),!this.loading(!1)){this.loading(!1,!0);var e=function(){a.loading("transactions")||n||(a.transactions.innerHTML="",a.transfers={},delete a.pagination_identifier,a.wallet.classList.contains(a.states.transactions_opened)&&a.load_transactions())};this.api({action:"get_wallet"}).then(function(t){a.wallet.getElementsByClassName("balance")[0].getElementsByTagName("span")[0].innerHTML=Number(t.available_balance).toLocaleString(),a.wallet.getElementsByClassName("info-id")[0].getElementsByTagName("span")[0].innerHTML=a._(t.token_holder_address)}).finally(function(){e(),a.loading(!1,!1)})}}},{key:"collapse_transactions",value:function(t){if(void 0!==t&&t.preventDefault(),void 0!==this.pagination_identifier||this.loading("transactions")||this.wallet.classList.contains(this.states.transactions_opened)||this.load_transactions(""),!this.wallet.classList.contains(this.states.transactions_opened)){this.transactions.scrollTop=0;var a=this.transactions.querySelector(".transaction--details");a&&a.remove()}this.wallet.classList.toggle(this.states.transactions_opened)}},{key:"preload_transactions_on_scroll",value:function(){this.transactions.scrollHeight-this.transactions.scrollTop-2*this.transactions.offsetHeight<100&&!this.loading("transactions")&&this.load_transactions()}},{key:"load_transactions",value:function(t){var a=this;if((void 0===this.pagination_identifier||!1!==this.pagination_identifier)&&!this.loading("transactions")){this.loading("transactions",!0);var n=t||this.pagination_identifier;this.api({action:"get_ledger",pagination_identifier:n}).then(function(t){a.pagination_identifier=t.meta.next_page_payload.pagination_identifier||!1;var n=!0,e=!1,s=void 0;try{for(var i,r=t.transactions[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var o=i.value,l=void 0;"community reward"===o.meta_property.name?l="community_reward":"shop_payment"===o.meta_property.name&&(l="shop_payment");var c=o.transfers[0],d=c.from===a.wallet_address?"debt":"income",p={name:c["".concat("debt"===d?"to":"from","_name")],address:c["debt"===d?"to":"from"]},u=o.meta_property.name,f=String(o.meta_property.details).trim();""!==f&&(u+=" (".concat(f,")"));var m=new Date(1e3*o.updated_timestamp),v=c.amount,h=document.createElement("div");h.className="transaction--block",h.setAttribute("data-id",o.id),h.innerHTML='<div class="transaction--info transaction--type-'.concat(d,'">')+'<div class="transaction--icon">'+'<div class="transaction--icon--'.concat(l||"none",'"></div>')+'</div><div class="transaction--summary">'+'<span class="transaction--title">'.concat(a._(u),"</span>")+'<span class="transaction--user">'+a._(p.name)+"</span>"+'<span class="transaction--time">'.concat(m.toLocaleString(),"</span>")+'</div><div class="transaction--amount">'+v+"<span>Tokens</span></div></div>",a.transfers[o.id]=o,a.transactions.appendChild(h)}}catch(t){e=!0,s=t}finally{try{n||null==r.return||r.return()}finally{if(e)throw s}}}).finally(function(){return a.loading("transactions",!1)})}}},{key:"transaction_details",value:function(t){t.preventDefault();for(var a=t.target||null;;){if(null===a)return;if(a.classList.contains("transaction--info")){a=a.parentElement;break}a=a.parentElement}var n=this.transfers[a.getAttribute("data-id")||""];if(n)if(a.getElementsByClassName("transaction--details").length>0)a.getElementsByClassName("transaction--details")[0].remove();else{var e=n.transfers[0],s=e.from===this.wallet_address?"debt":"income",i=document.createElement("div");i.className="transaction--details",i.innerHTML="<span>Status:</span> ".concat(n.status,"<br>")+"<span>Type:</span> ".concat(n.meta_property.type,"<br><br>")+("debt"===s?'<span class="primary">To</span><br>'+"<span>Name:</span> ".concat(this._(e.to_name),"<br>")+'<span>Address:</span> <span class="small">'.concat(this._(e.to),"</span><br>")+'<span>User ID:</span> <span class="small">'.concat(this._(e.to_user_id),"</span><br><br>"):'<span class="primary">From</span><br>'+"<span>Name:</span> ".concat(this._(e.from_name),"<br>")+'<span>Address:</span> <span class="small">'.concat(this._(e.from),"</span><br>")+'<span>User ID:</span> <span class="small">'.concat(this._(e.from_user_id),"</span><br><br>"))+'<span class="primary">Technical info</span><br>'+'<span>ID:</span> <span class="small">'.concat(n.id,"</span><br>")+'<span>Hash:</span> <span class="small">'.concat(n.transaction_hash,"</span><br>")+"<span>Block:</span> #".concat(n.block_number,' <span class="small">(').concat(new Date(1e3*n.block_timestamp).toLocaleString(),")</span>");var r=this.transactions.querySelector(".transaction--details");r&&r.remove(),a.appendChild(i),this.transactions.scrollTop=a.offsetTop}}},{key:"loading",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1?arguments[1]:void 0,n="".concat(this.states.loading).concat(t?"--".concat(t):"");switch(a){case!1:this.wallet.classList.remove(n);break;case!0:this.wallet.classList.add(n);break;default:return this.wallet.classList.contains(n)}}},{key:"api",value:function(t){return new Promise(function(a,n){$.ajax({method:"POST",dataType:"json",url:"/community/wp-admin/admin-ajax.php?lang=en&bpml_filter=true",data:t,success:function(t){a(t)},error:function(t){n(t)}})})}},{key:"copy_wallet",value:function(){var t=this,a=this.wallet.getElementsByClassName("info-id")[0].getElementsByTagName("span")[0].innerText;a=String(a).trim();try{navigator.clipboard.writeText(a).then(function(){t.notify("Wallet ID copied!")},function(t){return console.error("Copying error: ".concat(t))})}catch(t){}}},{key:"notify",value:function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1500;if(!(this.wallet.getElementsByClassName("wallet--nofication").length>0)){var n=document.createElement("div");n.className="wallet--nofication",n.innerHTML=t;var e=this.wallet.appendChild(n);setTimeout(function(){e.classList.add("wallet--nofication--show"),setTimeout(function(){e.classList.remove("wallet--nofication--show"),setTimeout(function(){e.remove()},300)},a)},100)}}},{key:"_",value:function(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}},{key:"create_wallet",value:function(){var t=document.createElement("div");return t.className="w-wallet",t.innerHTML='<div class="summary"><div><span class="title">Your wallet</span><div class="info-id">ID: <span></span></div><div class="balance"><span></span><br>LGBT Tokens</div><div class="actions"><a href="#" class="action--refresh" title="Refresh"><span></span></a><a href="#" class="action--transactions">Recent Transactions</a></div></div></div><div class="transactions"><div></div></div>',this.root.appendChild(t)}}])&&e(a.prototype,n),s&&e(a,s),t}();void 0!==window&&(window._Wallet=s),a.default=s},function(t,a){}]);